★【ハンズオン】CI/CD初級編/CopePipelineとCodeBuildでECSタスクをデプロイしよう
▼全体概要
	![[Pasted image 20250707142117.png]]
①Git Hub操作
	Git Forkの実行
		以下URLにアクセス
		URL：[https://github.com/CloudTechOrg/container-sample](https://github.com/CloudTechOrg/container-sample)
		![[Pasted image 20250707142813.png]]
		Fork押下
		![[Pasted image 20250707142856.png]]
		Create fork押下
	フォーク：他のユーザのリポジトリを自分のリポジトリにコピーすること
②ECR、コードビルドの作成
	　ECR
		![[Pasted image 20250707143343.png]]
		デフォルトの状態で作成
	コードビルド
		![[Pasted image 20250707143608.png]]
		![[Pasted image 20250707143854.png]]
		CodeConnections 経由で新しい GitHub押下
		![[Pasted image 20250707143832.png]]
		接続
		![[Pasted image 20250707145834.png]]
		ロール名：test-project-build-role
		![[Pasted image 20250707150009.png]]
		作成
	③IAMポリシーの追加
		![[Pasted image 20250707150124.png]]
		サービスロール押下
		![[Pasted image 20250707150211.png]]
		JSONで編集
			{ "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Action": [ "ecr:GetAuthorizationToken", "ecr:BatchCheckLayerAvailability", "ecr:GetDownloadUrlForLayer", "ecr:GetRepositoryPolicy", "ecr:DescribeRepositories", "ecr:ListImages", "ecr:DescribeImages", "ecr:BatchGetImage", "ecr:InitiateLayerUpload", "ecr:UploadLayerPart", "ecr:CompleteLayerUpload", "ecr:PutImage" ], "Resource": "*" } ] }
	④buildspec.ymlの変更
		ECRのURIをコピー
		![[Pasted image 20250707151049.png]]
		貼り付けてCommit changes押下
		![[Pasted image 20250707151724.png]]
		ビルドの開始
		![[Pasted image 20250707151838.png]]
		ビルドの確認
	⑤VPCなどの関連リソースの作成
		名前：container-test
		![[Pasted image 20250707152056.png]]
		sgの作成
		名前：container-test-public-sg
		![[Pasted image 20250707152312.png]]
	⑥ECSの作成
		タスクの作成
			タスク名：container-test-task
			コンテナ名：container-test-app
			イメージURL：491192276465.dkr.ecr.ap-northeast-1.amazonaws.com/test-ecr
			作成
		クラスターの作成
			名前：container-test-cluster
		サービスの作成
			名前：container-test-service
			![[Pasted image 20250707182813.png]]
	⑦確認
		URL：http://3.81.52.168/
		![[Pasted image 20250707183111.png]]
	⑧codePipelineの作成
		![[Pasted image 20250707183303.png]]
		![[Pasted image 20250707184341.png]]
		パイプライン名：container-test-pipeline
		![[Pasted image 20250707184455.png]]
		![[Pasted image 20250707184609.png]]
		![[Pasted image 20250707191719.png]]



★【ハンズオン】CodeシリーズでS3バケットの静的ウェブサイトホスティングを自動デプロイする
▼全体構成
	![[Pasted image 20250708175643.png]]
①S3バケットに静的ホスティングを設定
	テスト用
		バケット名：cth1-handson-bucket-test-
		![[Pasted image 20250708180407.png]]
		他デフォルト
		![[Pasted image 20250708180600.png]]
	本番用
		バケット名：cth1-handson-bucket-prod-takakura
		![[Pasted image 20250708180410.png]]
		他デフォルト
		![[Pasted image 20250708180555.png]]
		![[Pasted image 20250709151349.png]]
		htmlのアップロード
		![[Pasted image 20250709151630.png]]
		動作確認
		URL：http://cth1-handson-bucket-test-takakura.s3-website-ap-northeast-1.amazonaws.com
		![[Pasted image 20250709151759.png]]
	本番環境も同様の設定を行う
	URL：http://cth1-handson-bucket-prod-takakura.s3-website-ap-northeast-1.amazonaws.com
②Githubリポジトリーの作成
	名前：cth1-repo
	![[Pasted image 20250709161001.png]]
	上記コマンドをターミナルで実行していく
③codepipelineの設定
	パイプラインの作成
		名前：cth1-pipeline
		![[Pasted image 20250709161759.png]]
		![[Pasted image 20250709161922.png]]
	vscode上でindex.htmlファイルを修正しプッシュする
		git commit -a -m "v2.0" 
		git push -u origin main
	変更を確認
		![[Pasted image 20250709162503.png]]
④本番バケットのデプロイ設定
	アクショングループの追加
	![[Pasted image 20250709170046.png]]
	アクションプロバイダー：デプロイのS3を選択
	vscode上でindex.htmlファイルを修正しプッシュする
		git commit -a -m "v3.0" 
		git push -u origin main
	変更確認
	URL：http://cth1-handson-bucket-prod-takakura.s3-website-ap-northeast-1.amazonaws.com/
	![[Pasted image 20250709172314.png]]
⑤手動承認アクションの設定
	トピックの作成
		名前：  cth1-topic
		スタンダードを選択
	サブスクリプションの作成
		![[Pasted image 20250709172736.png]]
	パイプラインの編集
		アクションの編集
		![[Pasted image 20250709173230.png]]
	vscode上でindex.htmlファイルを修正しプッシュする
		git commit -a -m "v4.0" 
		git push -u origin main
		![[Pasted image 20250709174252.png]]
		![[Pasted image 20250709174311.png]]


★【ハンズオン】CodeシリーズでECS Fargateサービスをローリングデプロイする
▼全体概要
	![[Pasted image 20250709175556.png]]
	アクセスキー：xxxxxxxxxxxxxxxxxxxxxxxxx
	シークレットアクセスキー：xxxxxxxxxxxxxxxxxxxxxxxxxx
	URL：http://cth1-alb-1984563518.ap-northeast-1.elb.amazonaws.com/
	![[Pasted image 20250709214138.png]]


★【ハンズオン】CodeシリーズでECS FargateサービスをBlueGreenデプロイする
▼全体概要
	![[Pasted image 20250710204710.png]]
①ファイルの修正
	buildspec.yml
		![[Pasted image 20250710205503.png]]
	appspec.yml
		![[Pasted image 20250710205859.png]]
	taskdef.yml
		![[Pasted image 20250710210609.png]]
		![[Pasted image 20250710210620.png]]
②実行前準備
	ECSサービスの削除
		![[Pasted image 20250710210814.png]]
	ブルーグリーン用のサービスの作成
		サービス名：cth1-bluegreen-service
		![[Pasted image 20250710211108.png]]
		![[Pasted image 20250710211213.png]]
		![[Pasted image 20250710211356.png]]
		![[Pasted image 20250710211421.png]]
		![[Pasted image 20250710211536.png]]
		作成
③パイプラインの設定
	ローリングデプロイ削除
		![[Pasted image 20250710213443.png]]
	ブルーグリーンデプロイの作成
		![[Pasted image 20250710213807.png]]
		![[Pasted image 20250710213837.png]]
		完了→保存
④動作確認
	index.htmlの修正
		![[Pasted image 20250710214252.png]]
	vscodeで以下コマンド実施
		git add .
		git commit -a -m "v7.0
		git push -u origin main
	URL：http://cth1-alb-1984563518.ap-northeast-1.elb.amazonaws.com/
	![[Pasted image 20250710221506.png]]
	ロールバックさせる
		![[Pasted image 20250710221845.png]]
		![[Pasted image 20250710221854.png]]
⑤バージョン管理しやすくなる
	![[Pasted image 20250710222907.png]]
	![[Pasted image 20250710222918.png]]


★【AWS CLI】概要/設定ファイルについて
▼AWS CLI
	![[Pasted image 20250711012727.png]]
	AWSリソースをコマンドラインで操作（表示、作成、削除など）
	　実行環境
		　ローカルにAWS CLIをインストール
		　CloudShellを使う
		　パブリックサブネットにEC2インスタンスを構築する
▼設定ファイル
	![[Pasted image 20250711012850.png]]
		config
			output：出力形式の設定
			region：リージョンの設定
		credentials
			アクセスキー
			シークレットアクセスキー
			※外部に後悔しない


★【AWS CLI】コマンド概要/プロファイルの使い分け/クエリとJMESPass
▼コマンド概要
	fキー：次のページ
	bキー：前のページ
	qキー：helpのページ
▼プロファイルの使い分け
	![[Pasted image 20250711014719.png]]
	default 部分に名前を決め使い分けることができる
	aws configure --profile ec2-user
	![[Pasted image 20250711015301.png]]
	  ●補足
		 「–profile ユーザー名」は毎回指定しなくても環境変数に設定できます。  
		・Linux,Macの場合  
		**export AWS_PROFILE=ユーザー名**  
		例）export AWS_PROFILE=S3user  
		・Windowssの場合  
		**setx AWS_PROFILE ユーザー名**  
		例）setx AWS_PROFILE S3user


★【AWS CLI】CLIコマンド実行時のMFA追加認証設定
![[Pasted image 20250711022021.png]]
AKIAXEXKXKXYY6YDZHRR
KPq0pGTqnwWowx8Rwd2H//
arn:aws:iam::491192276465:mfa/test-2-delete

```plain
source_profile =
role_arn =
mfa_serial =
```


★【AWS CLI】S3の用語のおさらい/S3Uri/aws s3 基本コマンドの実践/mb, cp, mv, rm, rb
mb：make bucket
	![[Pasted image 20250711023558.png]]
cp：コピー
	![[Pasted image 20250711023810.png]]
	![[Pasted image 20250711023906.png]]
	recursive：再起的
mv：変更
	![[Pasted image 20250711023956.png]]
rm：削除ファイル
	![[Pasted image 20250711024037.png]]
rb：削除バケット
	![[Pasted image 20250711024105.png]]
