
★AWSグローバルインフラストラクチャ

▼AWSグローバルインフラストラクチャとは
	世界中に展開されているAWSの施設全体のことを指します。
	![[Pasted image 20250618211948.png]]

![[Pasted image 20250618212254.png]]

▼リージョン（Region）とは
	データセンターが設置されている地理的な範囲（国や広範囲な地域）のこと
	
	●補足
	・AWSでは世界中の施設をリージョンと呼ばれる地域単位に分割して管理している
	・日本には、東京と大阪の二つのリージョンがある
	・基本的に東京が推奨

▼アベイラビリティゾーンとは
	一つ以上のデータセンターをまとめた単位でAZとも略される

	●補足
	・データセンターを一か所に集めずに、分散して配置することで１つのデータセンタに障害が発生した
	場合に他のデータセンターでサービスを継続することができる
	・東京リージョンには４つ、大阪は３つ

▼エッジロケーション（Edge Location）
	地理的に離れたユーザーにもより素早くコンテンツを背信することができます

	●補足
	・CDNサービス、DNSサービス、Route53などの各種サービスの提供をサポートしている施設
	・リージョンごとに存在する

▼まとめ
	世界中には色々なリージョンが点在している。
	これらのリージョンは高帯域で冗長化されたAWSの専用のネットワーク回線で接続されている

	●補足
	・高帯域で冗長化とは、安定した品質で、ハイスピードな、故障に強いネットワーク、ということ



★責任共有モデル
	![[Pasted image 20250618213257.png]]
▼AWSの責任
	リージョン、AZ、エッジロケーションなどの施設です。
	それに伴うハードウェア、つまりグローバルインフラストラクチャーそのものに責任を持つ

	●補足
	・データセンター内で稼働している物理的なサーバー、ストレージ、データべース、ルータなどの機器

▼ユーザーの責任
	上記以外のすべて

	●補足
	・OSのパッチ、アプリの接続制限、ファイアーウォール設定セキュリティを保つレイヤーなど
	・開発したアプリの取り扱うデータなど

▼まとめ
	![[Pasted image 20250618214026.png]]
	AWSは物理的なものに対して責任を持つ
	ユーザーはそれ以外のものについて責任を持つ


★クラウドコンピューティングの６つの長所
	![[Pasted image 20250618214732.png]]

▼固定費から変動費へ
	![[Pasted image 20250618215229.png]]
	AWSは従量課金制を採用しているため、オンプレと比べて多額の初期投資が不要

	●補足
	・オンプレの場合はサーバ、ネットワーク機器、セキュリティ機器、電源設備などの
	物理的な機器を所有する必要があるためコストがかかる

▼規模の経済
	![[Pasted image 20250618215307.png]]

	一定量の規模や数量を確保することで、１つ当たりのコストが下がる考え方

▼キャパシティ予測が不要となる
	![[Pasted image 20250618215451.png]]
	足りなくなった分だけリソースを追加することができる

▼速度と俊敏性の向上
	![[Pasted image 20250618215648.png]]
	AWSでは、クリックで新しいサーバーが数分以内に使用できる

	●補足
	・オンプレでは数週間単位でかかっていた
	・俊敏性の向上により、マーケットトレンドに素早く対応できる

▼データセンターの運用や保守への投資が不要
	![[Pasted image 20250618215935.png]]
	データセンターやインフラにコストを費やすのはやめ、もっと価値のあることに集中しようという働き

	●補足
	オンプレで必要だったメンテナンスなどの手間のかかる作業が不要になった

▼グローバル化を即座に実現
![[Pasted image 20250618220241.png]]
	世界中にすぐにデプロイできる利点


★VPCとは リージョン/AZ/サブネット
▼VPCとは
	![[Pasted image 20250619153906.png]]
	AWS内部の仮想ネットワーク空間
	VPC内に複数のコンポーネント部品を作成できる
		・subnet
		・NAT gateway
		・Route table
		・セキュリティの設定
	●補足
	・マルチVPC：一つのアカウントで複数のVPC
	・マルチアカウント：子アカウントにVPCを作る ←大規模な開発向け

▼AZ
	![[Pasted image 20250619154532.png]]
	アカウントによって示すAZは違うためAZIDを気にする

▼サブネット

	VPC内の小さなネットワークのこと
	●補足
	・AZは跨げない

	▼パブリックサブネット
		・インターネット接続可
		ルートテーブルにインターネットゲートウェイへのルーティングあり

	▼プライベートサブネット
		・インターネット接続不可
		ルートテーブルにインターネットゲートウェイへのルーティング無し

	▼サブネットのIPアドレス
		VPCのアドレスレンジ隊は /16~/28の範囲内で作る制約がある

	▼サブネット構成
	
![[Pasted image 20250619161451.png]]
		・マルチAZ構成で障害に強い設計を作る
		・サブネットを/24で分けることでサブネットあたり256個のIPアドレスを確保
		・余裕持ってIPアドレスを確保しておく


★ルートテーブル/インターネットゲートウェイ/NATゲートウェイ/ENI/Elastic IPアドレス
	![[Pasted image 20250619161552.png]]

▼ルートテーブル
	・サブネットに関連付けて使用
	・サブネットから外に出る通信をどこに向けて発信するか決めるルール・定義
	・ルートと呼ばれるルールで構成される
	・複数のルートの集まりをルートテーブルという
	・最も明確なルールが優先されて適用
	![[Pasted image 20250619162147.png]]

▼インターネットゲートウェイ
	![[Pasted image 20250619162343.png]]
	![[Pasted image 20250619162708.png]]
	・送信先：0.0.0.0 ターゲット：Internet gateway → デフォルトゲートウェイ
	・パブリックサブネット：デフォルトゲートウェイとしてインターネットゲートウェイが設定されているもの →外部公開してもよいAWSリソース
	・プライベートサブネット：デフォルトゲートウェイとしてインターネットゲートウェイが設定されていないもの →セキュリティレベルの高いDBなど

▼NATゲートウェイ
	![[Pasted image 20250619163359.png]]
	・AWS主体で通信でコネクションを張りやり取りができるが、外部主体ではできない
	・送信先：0.0.0.0 ターゲット：NAT gateway → プライベートサブネットからインターネット接続が可能になる

▼ENI（Elastic Network Interface）
	![[Pasted image 20250619164336.png]]
	・EC2のIPアドレスのようなもの
	・インスタンスに複数のENIをアタッチできる

▼Elastic IPアドレス/パブリックIPアドレス
	インターネット接続用のIPアドレスは下記のどちらか1つしか持てない
	▼Public IP address
		・インターネットと通信できるIPアドレス
		・自動割り当て
		・EC2インスタンスが停止、終了するとプールに戻る
		●補足
		・セキュリティ制御の変更が必要になってくる
	▼Elastic IP address
		・インスタンスにアタッチ/でタッチが可能で性的なパブリックIPアドレス
		・インスタンスが再起動、停止、終了しても同一アドレス

★セキュリティグループ/ネットワークACL
▼Security group
	・ENI単位のファイアーウォール
	・インバウンド/アウトバウンドにも設定可能
	・拒否ルールの設定はできない
	・より幅広い範囲のIPアドレスが許可される
	・インスタンスごとにセキュリティグループをアタッチする
	・サイダー単位での許可ルールの設定
	・セキュリティグループ単位での許可ルールの設定
		▼ステートフル・インスペクション型
		![[Pasted image 20250619172618.png]]
		・アウトバウンドの設定をすればインバウンドは気にしなくてもいい

▼ネットワークACL（NACLs）
	・サブネット単位で設定するファイアーウォール
	・サブネットはNACLsを一つしか持てない
	・Rule # の番号の小さいものから評価され、最初にマッチした行のルールが適応、それ以降はされない
		▼ステートレス・インスペクション型
		![[Pasted image 20250619173206.png]]
		・インバウンドも明示的な設定が必要

▼セキュリティグループ/ネットワークACL比較
![[Pasted image 20250619173624.png]]


★サーバーについて/AMI/インスタンスタイプ/EBS/キーペア
▼サーバー
	![[Pasted image 20250619190639.png]]
	![[Pasted image 20250619190703.png]]
	・PCと似た分品で構成されている
	・上記のような物理機器の上にソフトウェアが導入されている
	・リソース：CPUやメモリのこと

	▼仮想サーバー
		仮想サーバーとはサーバー上に論理的なサーバーを作成したもの
		●補足
		・用途に合ったサーバーをセットアップできる

	▼ハイパーバイザー
		仮想サーバーを作ったり消したりするための専用ソフトウェア

▼EC2
	EC2も実態は仮想サーバーと同じ
	▼仮想サーバーとEC2の関係
		![[Pasted image 20250619191957.png]]
	▼AMI（Amazon Machine Image）
		AMI：OSやソフトウェアや設定を含む「イメージ」
		●補足
		AMIに含まれるもの
		・OS（例：Amazon Linux、Ubuntu、WindowsなどのベースのOS）
		・アプリケーションサーバなどの設定 → Apache,Nginx,Python,Javaなど
		・各種設定ファイル → セキュリティ設定やログ設定など
		・永続化されたデータ（必要に応じて）
	▼インスタンスタイプ
		仮想サーバーの「ハードウェアリソース」を定義したもの
		例：CPUの数、メモリの容量、ストレージの種類、ネットワーク性能など最適なものを選ぶ
		![[Pasted image 20250619194437.png]]
		
		▼インスタンスタイプの命名規則
		例：t2.micro
		tはファミリー名
		数字は世代番号 → 大きいものが最新で最適化されている
		microはインスタンスサイズ → スペック
		▼インスタンスの種類
		・T系
		
![[Pasted image 20250619194836.png]]
		・T系インスタンスの「バースト」とは
		![[Pasted image 20250619195122.png]]
		・M系
		![[Pasted image 20250619195255.png]]
		・C系
		![[Pasted image 20250619195320.png]]
		・R系
		![[Pasted image 20250619195352.png]]
		・P系
		![[Pasted image 20250619195429.png]]
		・H系
		![[Pasted image 20250619195508.png]]

▼EBS（Elastic Block store）
	・EC2にアタッチして使用する外付けディスク
	・種類に応じてIOPS（性能）が異なる
	・スナップショットを取得できる
	・AZの範囲内であれば複数のEBSをEC2にアタッチ可能
	▼SSDタイプ
		高価だが読み書きが高速
		・プロビジョンドIOPS SSD
		・汎用SSD
	▼HDDタイプ
		安価で読み書きが遅い
		・スループット最適化 HDD（st1）
		・Cold HDD（sc1）
	●補足
	・アタッチ：接続すること
	・デタッチ：取り外すこと

▼キーペア
	![[Pasted image 20250619200515.png]]
	・秘密鍵は外部からアクセスできない場所に保管する
	・複数のインスタンスに同じキーペアを使用できる
	 ▼windowsタイプのEC2場合
		EC2インスタンスを起動する際に生成した「**秘密鍵ファイル**」
	     Windowsのログインパスワードを復号化するために使います（初回のみ）
	     `.pemファイル` を使って取得した、**Windowsログイン用のパスワード**
	    例：`U6ruTBXHRn35QhDV`
	    これをRDPで接続時に使う

★ユーザーデータ / インスタンスメタデータ
▼ユーザーデータ
	・EC2が初回起動する際に実行するスクリプト
	・実行権限はrootユーザー権限
	・実行例：パッケージのアップデート、ソフトウェアのインストール、設定ファイルの取得
	▼記述方法
		![[Pasted image 20250619203543.png]]
		EC2作成時の「高度な詳細」にて記述
		記述形式
		・シェルスクリプト形式
		・cloud-init形式
		仕組み例
		![[Pasted image 20250619203738.png]]
		S3に保存してある設定ファイルをEndpointsを使用して取得し、セットアップコマンドで適応する
▼インスタンスメタデータ
	インスタンスの中に埋め込まれたデータ
	例：EC2のIPアドレス、ホストネーム、AMIのID番号
	▼IMDSv1
		実行コマンド
		curl http://xxx.xxx.xxx.xxx/latest/meta-data/
	▼IMDSv2 セキュリティ性が向上している
		実行コマンド
		TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` \
		&& curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/


★EC2インスタンス構築デモ/ユーザーデータ/インスタンスメタデータ/windowsサーバー作成

▼インスタンス起動
	![[Pasted image 20250620155116.png]]
	Name：test-ec2-1
	Enviroment：prod
	アーキテクチャ：x86
	インスタンスタイプ：t2.micro
	キーペア：test-ec2-key
	![[Pasted image 20250620155827.png]]
	セキュリティグループ名：test-sg-1
	説明：test-sg-1
	![[Pasted image 20250620160003.png]]
	![[Pasted image 20250620160015.png]]
	高度な設定
	メタデータのタグを許可：有効化
	![[Pasted image 20250620160418.png]]
	
	ユーザーデータ
	```plain
	#!/bin/bash
	echo "===yum -y install httpd==="
	yum -y install httpd
	
	echo "===systemctl start httpd.service==="
	systemctl start httpd.service
	
	echo "===systemctl enable httpd.service==="
	systemctl enable httpd.service
	
	echo "===get token===" #トークンを取得
	TOKEN=$(curl -s -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")
	echo $TOKEN
	
	echo "===get instance-id >> /tmp/test===" #見出し
	echo "instance-id" >> /tmp/test #見出し
	curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/instance-id >> /tmp/test
	
	echo "===get Tag===" #見出し
	echo "Name tag" >> /tmp/test #見出し
	curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/tags/instance/Name >> /tmp/test
	
	echo "Environment tag" >> /tmp/test #見出し
	curl -s -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/tags/instance/Environment >> /tmp/test
	```

起動後
	![[Pasted image 20250620160948.png]]
	ステータスチェックで2/2のチェックに合格していることを確認
	接続
		ssh接続
		秘密鍵が格納してあるディレクトリまで移動し下記コマンド実行
		コマンド：ssh -i test-ec2-key.pem ec2-user@18.182.62.54

▼エフェメラルポート
![[Pasted image 20250620171648.png]]

★IAMユーザー/IAMグループ/アクセスキー/IAMポリシー
▼IAMユーザー
	AWSアカウント範囲内で作成できる個別のユーザーのこと
	デフォルトだと何も権限を持たない
	AWS画面へのアクセスを提供するか選択できる
	●補足
	・人間ではなくプログラムが使う場合もある
	▼アクセスキー
		どこからでもAWSにアクセス可能
		●補足
		・外部に公開しない悪用されてるため
▼IAMグループ
	![[Pasted image 20250623162807.png]]
	 複数のIAMユーザーのまとまりで、グループに対して権限を付与できる
	 ●補足
	 ・ユーザーは複数のグループに所属できる
	 ・グループ内にグループを作成することはできない
▼IAMポリシー
	・AWSリソースにおける操作の拒否/許可を決めるもの
	・JSON形式で記述されたファイル
	・認証主体(Principal)にアタッチして使用
	●補足
	認証主体：IAMユーザーやグループに認証する側
	▼AWS管理ポリシー
		AWSがあらかじめ用意してくれているポリシーのこと
	▼カスタマー管理ポリシー
		直接JSONカスタマイズして作ることができる
		![[Pasted image 20250623164627.png]]
		作成方法
		・ビジュアル：権限をチェックをつけて作成
		・JSON：JSONを記述して作成
▼IAMロール
	・IAMポリシーをIAMロールにアタッチできる
	・JSON形式のファイル
	▼信頼ポリシー
		このロールを使える人を設定できる
		●補足
		EC2にもアタッチできる

▼まとめ
![[Pasted image 20250623165801.png]]


★JSON基礎講座
▼JSON
	![[Pasted image 20250623170649.png]]
	・キーとバリューで対比にさせたもの
	・ダブルコーテーションで囲われている
	・カンマで区切ることによって複数できる
	![[Pasted image 20250623170816.png]]
	▼バリュー
		・配列も可能
		![[Pasted image 20250623170931.png]]
		▼オブジェクト
		![[Pasted image 20250623171302.png]]


★IAMポリシー詳細
![[Pasted image 20250623174105.png]]
{
  "Version": "2012-10-17",  
  // ポリシーのバージョン指定（基本はこの日付を使う）

  "Statement": [  
    // ポリシー本体（複数書ける）
    {
      "Sid": "ListBucketRstIP",  
      // Statement ID（任意の名前。識別用）
      "Effect": "Allow",  
      // 許可か拒否かを指定（Allow＝許可、Deny＝拒否）
      "Principal": "*",  
      // 誰に適用するか（"*" は全員に適用）
      "Action": "s3:ListBucket",  
      // 許可する操作（ここではバケットの中身一覧を取得）
      "Resource": "arn:aws:s3:::sample-bucket",  
      // 対象のリソース（ここでは sample-bucket というバケット）
      "Condition": {  
        // 条件付きアクセスの指定
        "StringEquals": {  
          // 完全一致の条件
          "aws:SourceIp": "12.34.56.78"  
          // アクセス元IPアドレスがこの値のときだけ許可
        }
      }
    }
  ]
}
▼Not
	指定したもの以外を対象とする
	以下キーはNotを使用できる
		![[Pasted image 20250623174957.png]]
		・NotPrincipal
		・NotAction
		・NotResource


★ IAMポリシーをグループにアタッチして表示の変化を確認する
①接続テスト用のS3バケットの作成
	![[Pasted image 20250623181555.png]]
	バケット名：cloudtech-20250623-takakura
	※バケット名は被らないようにする
②IAMユーザー/グループの作成
	![[Pasted image 20250623182540.png]]
	ユーザー名：S3user
	![[Pasted image 20250623182930.png]]
	ユーザーグループ名：S3group(許可ポリシー無し)
③ユーザーをグループに所属させる
	![[Pasted image 20250623183349.png]]
④作成したユーザーでサインインし、S3にアクセス
	![[Pasted image 20250623183918.png]]
⑤管理者ユーザーでサインインしなおし、IAMポリシーを作成する
	![[Pasted image 20250623184317.png]]
	・ListAllMyBuckets
	![[Pasted image 20250623184615.png]]
	ポリシー名：test-policy
⑥作成したポリシーをグループにアタッチする
	![[Pasted image 20250623184841.png]]
	![[Pasted image 20250623184906.png]]
	test-policyを選択して、ポリシーをアタッチする
⑦S3userにサインインして、S3を確認する
	![[Pasted image 20250623190336.png]]
	 ※注意
	 バケットの中身までは見れない、別の許可設定が必要
	 ![[Pasted image 20250623190446.png]]

★ IAMロールをEC2にアタッチして権限の変化を確認する
①EC2にIAMロールがアタッチされてないことを確認
	![[Pasted image 20250623200041.png]]
②現状ではリストアップされないことを確認
	ターミナル操作
	以下コマンド実行
	aws s3api list-buckets
③権限を付与する
	IAMダッシュボードにアクセス
	ロールを作成する(許可ポリシーは設定しない)
	![[Pasted image 20250623200558.png]]
	信頼されたエンティティタイプ：AWSのサービス
	ユースケース：EC2
	ロール名：S3-bucket-policy
④EC2インスタンスのIAMロールを変更する
	![[Pasted image 20250623201101.png]]
⑤中身が空であることを確認する
	![[Pasted image 20250623201303.png]]
⑥IAMロールにポリシーをアタッチする
	![[Pasted image 20250623201637.png]]
	・AWS管理ポリシー：AmazonS3ReadOnlyAccess
	ポリシーの中身
	![[Pasted image 20250623202012.png]]
⑦中身を確認
	![[Pasted image 20250623201818.png]]
リファレンスでacttionの中身が確認できる


★ AWSを操作する3つの方法（API）
![[Pasted image 20250623205009.png]]
▼マネジメントコンソール
	WebブラウザからGUIで操作
▼AWSCLI
	コマンドラインで操作
▼SDK
	プログラミング言語を使用する方法
▼共通点
	エンドポイントに対して、HTTPプロトコルで指示を出している


★【RDS】RDS特徴/DBエンジン/マルチAZ/リードレプリカ/その他機能
▼Amazon RDS
	▼DBサーバーの役割
		データの保存・管理・提供を行うサーバー
		Webサーバーからのデータ要求に応じてデータを返す役割
	▼データベースサーバーの管理に考慮すべき点
		![[Pasted image 20250623205714.png]]
		自前でやろうとすると大変であった
	▼RDS(Relational Database Service)とは
	・マネージド型データベースサービス
	・EC2にデータベースの高度な機能がついたもの
	・マルチAZ・リードレプリカ機能
	▼対応エンジン
		![[Pasted image 20250623210208.png]]
		・Amazon AuroraはMySQLやPostgreSQLと互換性が高い
	▼RDSの実態
		![[Pasted image 20250623210429.png]]
	▼DNS名（エンドポイント）で接続する
	![[Pasted image 20250623210649.png]]
	名前変換機能で変換される
	▼マルチAZ機能
	![[Pasted image 20250623210733.png]]
	障害発生時にダウンタイムを抑えてくれる機能
	Primaryが障害が発生し停止してしまっても自動でSecondaryにフェイルオーバーしてくれる
	●補足
	・フェイルオーバー
	・プロモート：昇格
	▼リードレプリカ
	![[Pasted image 20250623211138.png]]
	処理によって更新用と参照用に分けて使用すること
	▼セキュリティグループを設定する
	![[Pasted image 20250623211237.png]]
	EC2が属しているSGからの3306ポートなら受け付けるという意味
	▼その他の機能
	![[Pasted image 20250623211353.png]]
	スナップショット：バックアップのこと
	![[Pasted image 20250623211518.png]]


★【RDS】Aurora / レプリカ / グローバルデータベース / マルチマスター / Aurora Serverless
▼Auroraサービス概要
	![[Pasted image 20250623212624.png]]
	▼DBクラスター
		![[Pasted image 20250623212819.png]]
		PrimaryのみWriteができる
	▼エンドポイント
		![[Pasted image 20250623213031.png]]
		・クラスターエンドポイント：現在のプライマリDBインスタンスに接続
		・リーダーエンドポイント：各レプリカで接続リクエストを負荷分散する
		・カスタムエンドポイント：ユーザーが作成したものでレプリカ間で負荷分散する
		・インスタンスエンドポイント：各プライマリ、レプリカのDBインスタンスに直接接続
	▼レプリカの詳細
		・書き込みはプライマリ、読み込みはレプリカを使用しクラスター全体の負荷軽減する
		・レプリカをプライマリに昇格させることで、障害対策になる
		・クラスターの中に最大15のレプリカを含める
	▼比較
		![[Pasted image 20250623213902.png]]
		Auroraのほうが優れている
	▼リージョン間のレプリケーション
		![[Pasted image 20250623214158.png]]
	▼グローバルデータベース
		![[Pasted image 20250623214346.png]]
		・別リージョンに非同期のレプリケーションを行い、1秒未満のレイテンシーで最大5つのセカンダリリージョンにレプリケートできる
		・プライマリDBクラスターのパフォーマンスにほとんど影響しない
		・セカンダリは1つのクラスターにつきレプリカを15件ではなく16件作成できる
		・セカンダリクラスターを使えば、迅速で少ないデータ損失でグローバルデータベースを新しいプライマリリージョンで使用できるようになる
	▼マルチマスター
		![[Pasted image 20250623215203.png]]
		・MySQLエディションのみの機能
		・レプリカの昇格昇格をなくし、障害発生までのタイムラグを採用減に押さえて可用性を高めている
		アクティブ/アクティブ：全てのDBインスタンスに対して同時に読み取りと書き込みを実行
		アクティブ/パッシブ：1つのDBインスタンスで、すべての読み書きを実行
		メイン以外はすべて予備で、メインが使用できなくなったときにサブに切り替え、書き込みのダウンタイムを最小限にしている
	▼Aurora Serverless
		![[Pasted image 20250623215906.png]]
		・自動でスケーリングする
		・ACU(Aurora Capacity Units)：処理能力とメモリ能力の組み合わせ
		・Proxy Fleet：Appサーバーとの仲介役


★【ハンズオン】Aurora作成-接続/手動フェイルオーバーによる動作確認/レプリカオートスケーリング/クローン取得
①RDSに設定する用のセキュリティグループを作成
	![[Pasted image 20250623222830.png]]
	・EC2 インスタンスのアタッチされているSGを許可する
	・3306の範囲で指定
②サブネットグループの作成
	![[Pasted image 20250623224419.png]]
	名前：subnet-group-1
	アベイラビリティーゾーン：a,c,d３つ選択
	サブネット：プライベートサブネット3つ選択
③Auroraの作成
	![[Pasted image 20250623224711.png]]
	![[Pasted image 20250623224814.png]]
	![[Pasted image 20250623224933.png]]
	![[Pasted image 20250623225047.png]]
	![[Pasted image 20250623225251.png]]
	![[Pasted image 20250623225410.png]]
④DBに接続
	EC2インスタンスを最新化する
	コマンド：sudo dnf update -y
	![[Pasted image 20250623230019.png]]
	DBのクライアントツールのインストール
	コマンド：sudo dnf install mariadb105
	![[Pasted image 20250623230214.png]]
	ライターインスタンスに接続
	コマンド：mysql -h mydatabase-instance-1.cbsukm0we4kp.ap-northeast-1.rds.amazonaws.com -P 3306 -u admin -p
	![[Pasted image 20250623230857.png]]
⑤DBの操作
	・DB作成
	コマンド：CREATE DATABASE db;
	・テーブル作成
	コマンド：CREATE TABLE db (
    ->   column1 INT,
    ->   column2 INT,
    ->   column3 INT
    -> ) CHARSET=utf8;
    ・値を入れる
    コマンド：INSERT INTO db VALUES (1,2,3);
    ・取得する
    コマンド：SELECT * FROM db;
⑥読み取り専用で操作
	![[Pasted image 20250623232059.png]]
    リードレプリカでは読み取りしかできない
⑦ロールの作成
	![[Pasted image 20250623232421.png]]
⑧EC2にAuroraの操作をできるようにする
	![[Pasted image 20250623232526.png]]
⑨IPアドレスの確認
	コマンド：nslookup mydatabase-instance-1.cbsukm0we4kp.ap-northeast-1.rds.amazonaws.com
	![[Pasted image 20250623232750.png]]
⑩オートスケーリングの確認
	![[Pasted image 20250623233041.png]]
	![[Pasted image 20250623233057.png]]
⑪フェイルオーバー
	コマンド：aws rds failover-db-cluster --db-cluster-identifie mydatabase
	![[Pasted image 20250623233403.png]]
	確認
	![[Pasted image 20250623233613.png]]
	振り分けているのを確認
	![[Pasted image 20250623234303.png]]
⑫クローンの作成
	![[Pasted image 20250623234524.png]]


★タグのベストプラクティス / Tag Strategy(タグ戦略)
▼タグ
	タグ：AWSリソースに付与できる管理情報
	・AWSが自動で付与するタグ（aws:~）
	・ユーザが作成するタグ(Nameタグなど)50個までの制限
	・大文字小文字が区別される
	▼タグをつけない問題点
		・リソースの判別に時間がかかる
		・コスト計算が大変
	▼メリット
		・検索
		・管理
		・フィルタリング
		・タグごとにコストを把握
		・AWS Resource Groups画面にて一括タグ管理
		![[Pasted image 20250624171158.png]]
		・タグを用いたセキュリティ設定も可能
		![[Pasted image 20250624171347.png]]
▼タグのベストプラクティス
	前提：何がベスト化は組織の方針やシステム特性に左右される
	根本的な考え方
	・機密情報をタグ付けしないこと
	・タグを持続的に管理するための戦略を立てる事
	・タグはシンプルなほど良い。継続的に見直すこと
▼タグのカテゴリー
	![[Pasted image 20250624171921.png]]
	▼技術タグ（テクニカル系）
		・環境：環境がわかるようにタグ付け
		例：stg、dev
		・機能：どのような機能かわかるようなタグ付け
		例：db、batch
		・システム名：システム名がわかるようにタグ付け
		例：mail、blog 
	▼オートメーションタグ（自動系）
		・バックアップ周期、時間：バックアップを取る時間など
		例：daily-0100、weekly-mon-0400
		・セキュリティパッチ適用：セキュリティパッチを適応する対象だったり
		例：stg、prod
		・自動起動/停止時刻：自動起動などの設定
		例：0700、0800
	▼ビジネスタグ（管理系）
		・プロジェクト名
		例：log-audit
		・部門名
		app、security
		・管理者
	▼セキュリティタグ（監査系）
		・監査要件
		・重要データ保持リソース
	●補足
	・すべて小文字がおすすめ
	・区切り文字をルール化する
	![[Pasted image 20250624173436.png]]


★課題
	詰まった
	![[Pasted image 20250625005650.png]]
	APIサーバーがパブリックIPだったため、インスタンスを停止/再起動した時点でIPアドレスが変更された。そのためWebサーバーが呼び出すAPIサーバーのIPアドレスが古い状態になっていたためエラーが起きていた


★【ALB】ALBの概要/基本用語/ヘルスチェック/ALBとNLBの違い
▼ALBとは
	ロードバランサ
	![[Pasted image 20250625152102.png]]
	・複数のAZに跨って配置する
	▼通信振り分け方法
		・ラウンドロビン：交互に
		・最小未処理リクエスト方式：忙しさに応じて
	▼ALBとEC2のセキュリティグループの設定
		![[Pasted image 20250625152507.png]]
		EC2のセキュリティグループの範囲をALBのセキュリティグループを指定する
▼リスナー/ターゲットグループ/ヘルスチェック
	![[Pasted image 20250625153029.png]]
	▼リスナー
		通信を受け付ける
		リスナールールを設定することでターゲットグループかを選択している
	▼ターゲットグループ
		ALBと紐づける
	▼ヘルスチェック
		ターゲットが正常か監視する
▼ELB4種
	![[Pasted image 20250625153452.png]]
	ALB：外部向け、インターネット通信
	NLB：内部向け、webサーバとapiサーバの中間に位置


★【ALB】ALBの各種用語と通信の流れ / リスナー / リスナールール アクション ターゲット / ターゲットグループ
	![[Pasted image 20250625155445.png]]
	![[Pasted image 20250625155521.png]]
	![[Pasted image 20250625155543.png]]
	![[Pasted image 20250625155602.png]]


★【AutoScaling】概要 / 起動テンプレート / AutoScalingグループ / スケーリングポリシー
▼概要
	EC2を条件に合わせて増減してくれるサービス
	大量通信の負荷にも対応できる
	![[Pasted image 20250625160724.png]]
▼起動テンプレート
	通常のEC2を作成する際の設定を一まとめにしたもの
▼AutoScalingグループ
	起動テンプレートを紐づけ
	最小、希望、最大を指定する
	ELBのターゲットグループと紐づけることができる
▼スケーリングポリシー
	クラウドウォッチのアラームを受けて、EC2の増減の条件を設定


★【ハンズオン】起動テンプレート作成/ALBとAutoScalingを組み合わせたハンズオン
▼概要
	![[Pasted image 20250625162814.png]]
①VPC、パブリックサブネット、ルートテーブル作成
	![[Pasted image 20250625163128.png]]
	![[Pasted image 20250625163146.png]]
	・VPC：１
	・パブリックサブネット：２
	・ルートテーブル：１
	・インターネットゲートウェイ：１
②EC2起動
	名前：hands-on-ec2
	通常通りの設定に加え以下を実行
		![[Pasted image 20250625164225.png]]
		・セキュリティグループルールを追加し、画像のように設定
		![[Pasted image 20250625164337.png]]
		・高度な詳細を開き、ユーザーデータを入力
		URL：https://github.com/CloudTechOrg/course-info/blob/main/sprint-03.md
③テンプレートの作成
	![[Pasted image 20250625165307.png]]
	基本的には起動中のEC2の設定がそのまま反映される
	テンプレート名：lt-hands-on
	バージョンの説明：lt-hands-on-v1
	※注意
	高度なネットワーク設定にて、パブリックIPの自動割り当てが有効であることを確認
	![[Pasted image 20250625165808.png]]
④Auto Scaling グループの作成
	![[Pasted image 20250625170200.png]]
	名前：hands-on-asg
	![[Pasted image 20250625170348.png]]
	バージョン：Latest（常に最新のバージョンを使用）
	![[Pasted image 20250625170527.png]]
	作成したVPC(hunds-on-vpc)を選択
	作成したサブネットを選択
	![[Pasted image 20250625170905.png]]
	Internet-facing：外部向け
	![[Pasted image 20250625170922.png]]
	サブネット二つを設定することで、この二つに跨ってくださいとなる
	![[Pasted image 20250625171240.png]]
	![[Pasted image 20250625171444.png]]
	作成する
⑤ロードバランサのセキュリティグループ作成し、ロードバランサに反映
	![[Pasted image 20250625172548.png]]
	![[Pasted image 20250625172615.png]]
⑥EC2インスタンスを削除した時、自動で作成されることを確認

★【CloudWatch】概要/全体像/メトリクス/アラーム評価
▼概要
	・AWSの監視マネージドサービス
	例：EC2のCPU使用率が90%を超えた場合にアラーム通知を行えるなど
▼全体像
	![[Pasted image 20250625182057.png]]
	メトリクスを収集→特定の条件下になったらアラームを発砲する→アクションを行う
	収集したデータを分析
	●補足
		SNS（simple notification service）
		![[Pasted image 20250625182603.png]]
		画像のような流れでメッセージが送信される
	▼CloudWatchを使うべき理由
		・自動でメトリクス収集する
			CPU使用率やディスクの読み書きをデフォルトで収集
		・従量課金制
		・高解像度の監視可能
			5分間隔は無料、有料で1分間隔で可能
		・オンプレも監視可能
			CloudWatchエージェントを入れることで、オンプレも使用可能
▼メトリクス
	・標準メトリクス：予めAWSが用意したメトリクス
		例：CPU使用率、NWパフォーマンスなど
	・カスタムメトリクス：ユーザーが設定したメトリクス
		例：メモリ使用率など
		※EC2はIaaSなので、O/S以上の階層はユーザに責任があるため自分で設定する必要がある
▼CloudWatchエージェント
	条件
	・CloudWachエージェントをEC2にインストールする
	・EC2にIAMロールをアタッチする
	・適切なネットワークルートを設定する
		⇒プライベートサブネットにEC2を設置している場合、VPCエンドポイントなど  
		　の仕組みを利用して適切なネットワークルートを確保する必要がある
　▼アラート評価
	　![[Pasted image 20250625184711.png]]
	　3つの評価軸
	　・Period：評価間隔
	　・Evaluation Period：直近、何個のPeriodを評価対象とするか
	　・Datapoints to Alarm：評価対象のうち、何個のPeriodが閾値を超過したか
	▼アラームのステータス
		OK：閾値内の値
		ARARM：閾値外の値
		INSUFFICIENT：収集し始めでアラームの状態の判断するには不十分な値
		▼欠落データの取り扱い
			![[Pasted image 20250625185125.png]]


★【ハンズオン】CloudWatchアラーム設定とSNSによるメール通知設定
▼概要
	![[Pasted image 20250625185754.png]]
①VPC、パブリックサブネット、ルートテーブル、IGWを作成
②EC2インスタンスの作成
③SNSトピックの作成
	![[Pasted image 20250625190738.png]]
	![[Pasted image 20250625190853.png]]
	タイプ：スタンダード
	名前：hands-on-topic
④サブスクリプションの作成
	![[Pasted image 20250625191003.png]]
	![[Pasted image 20250625191100.png]]
	トピックARN：作成したものを選択
	プロトコル：Eメール
	エンドポイント：gaocangdaxi@gmail.com
	作成後、認証のメールがくるのでチェック
⑤アラームの作成
	![[Pasted image 20250625191534.png]]
	参照→EC2→インスタンス別メトリクス→CPUUtilization 選択
	![[Pasted image 20250625191701.png]]
	![[Pasted image 20250625192006.png]]
	![[Pasted image 20250625192112.png]]
	![[Pasted image 20250625192231.png]]
	アラーム名：hands-on-alarm
⑥EC2に負荷をかける
	sshでログインし、下記コマンドの実行
	sudo yum install -y stress
	stress --cpu 1 --timeout 600
⑦メールを確認
	![[Pasted image 20250625194329.png]]



★【EC2】インスタンス購入方法 / オンデマンド / リザーブド / スポット / Savings
▼EC2インスタンスの購入方法
	・オンデマンドインスタンス：デフォルトの購入方法
	・リザーブドインスタンス・Saving Plans：長期利用
	・スポットインスタンス：短期利用
	▼購入方法の違い
		![[Pasted image 20250625202343.png]]
	▼オンデマンドインスタンス
		・デフォルトの購入方法
		・仮想マシンの実行時間によって課金される
		・3種類の購入方法の中で最も効果
	▼リザーブドインスタンス（RI）
		・最大72%OFF
		・「一定期間の使用」前提
		・1年or 3年で申し込む
		・一定期間は同じインスタンスタイプのEC2を使い続けることを先に申し込み
	▼Savings Plans（SP）
		・最大72%OFF
		・「一定期間、一定量の使用」前提
		・1年or 3年で申し込む
		・予め利用料を計算したうえで、一定期間、1時間に何ドル分AWSを使うかを先に申し込み
	▼スポットインスタンス
		・最大90%OFF
		・入札モデル
		・AWSの空リソースを使用
		・価格変動
▼リザーブドインスタンス
	▼クラス
		・スタンダード
			変更不可（リスクが高い）
		・コンバーティブル
			変更可能
	▼支払いオプション
		・全額払い
		・一部前払い
		・前払いなし（1年のみ）
	●補足
		EC2以外のサービスでも同様の購入方法がある
		・RDS
		・RedShift
		・DynamoDB
		・ElasticCache
		・Elasticsearch Service


★【EC2】EC2購入方法 / Savings Plansとリザーブドとの違い
▼Savings Plans（SP）
	▼Compute Savings Plans
	![[Pasted image 20250625210531.png]]
	▼EC2 Instance Savings Plans
	![[Pasted image 20250625210547.png]]
	▼支払いオプション
		・全額払い
		・一部前払い
		・前払いなし（1年のみ）
▼リザーブドインスタンス（スタンダード）との違い・使い分け
	![[Pasted image 20250625210904.png]]
	・購入時の指定の仕方が違う
▼リザーブドインスタンス（コンバーティブル）との違い・使い分け
	![[Pasted image 20250625211136.png]]
	・購入時の指定の仕方が違う


★【EC2】Savings Plans購入方法デモ
![[Pasted image 20250625211406.png]]
![[Pasted image 20250625211936.png]]
いくらかかるか計算
①割引プランの購入→Savings Plans購入
![[Pasted image 20250625211907.png]]
![[Pasted image 20250625211916.png]]


★スポットインスタンスの特徴と操作デモ
①インスタンスを起動
	![[Pasted image 20250626234144.png]]
②ラジオボタンで選択
	![[Pasted image 20250626234605.png]]
③リクエストタイプ
	![[Pasted image 20250626234716.png]]
	インスタンスが中断した時のアクション
	1回限り：テストなどの短期間のタスク向きで中断されてもいいもの
	永続：バッチ処理やバックエンド処理など
④中断動作選択
	![[Pasted image 20250626234954.png]]
⑤作成する
	スポットインスタンスで作成されたことを確認
	![[Pasted image 20250626235529.png]]
	オンの状態にし、列の一番はじに「spot」と記載される
	![[Pasted image 20250626235611.png]]


★WAFとは/IDS,IPS/WAFとFWの防御レイヤーの違い
![[Pasted image 20250626235936.png]]
![[Pasted image 20250626235953.png]]
▼IDS（Intrusion Detection System）
	![[Pasted image 20250627000601.png]]
	・Webサーバーを動かしているOSなどソフトウェアやネットワークを保護
	・不正なアクセスや異常がないかをリアルタイムでチェックし、検知した場合は管理者へ通知を行う
▼IPS（Intrusion Prevention System）
	![[Pasted image 20250627000545.png]]
	・Webサーバーを動かしているOSなどソフトウェアやネットワークを保護
	・不正アクセスや異常がないかをリアルタイムでチェックし、検知した場合は侵入を遮断などのアクションを行う
	▼IDS、IPSの種類
		![[Pasted image 20250627000949.png]]
		ネットワーク型
			・ネットワークに配置される
			・ネットワーク上を流れる通信パケットの中身を監視する
		ホスト型
			・サーバー上にインストールされる
			・ログファイルやファイルの改ざんなどを監視する
▼WAF（Web Application Firewall）
	・Webサーバやデータベースの前面に配置され、Webアプリケーションを保護
	・クロスサイトプティング、SQLインジェクションといったアプリケーションの脆弱性をついた攻撃をブロックする
	![[Pasted image 20250627001356.png]]
	▼WAFの種類
		・ソフトウェア型
		・アプライアンス型
		・クラウド型
		![[Pasted image 20250627001753.png]]
	▼WAFとファイアーウォールの違い
		![[Pasted image 20250627002135.png]]
		・ファイアーウォール：通信をIPアドレスやポート番号で見て通貨・遮断を判断する
		・WAF：Webアプリケーションへの通信の中身を見て通過・遮断を判断
			例：SQLインジェクションなど
		→ファイアーウォールとWAFは役割が異なり、どちらも必要
		![[Pasted image 20250627002312.png]]
	▼AWS WAF
		・AWSが提供するWAFサービス
		・マネージドサービスであるため、死活監視やファームウェアアップデートなどWAFサーバ自体の管理が不要
		・きめ細やかなルールのチューニングはできないため、高度なセキュリティ要件がある場合には、他セキュリティベンダーが提供するWAFの利用を検討が必要


★【AWS WAF】Web ACL/マネージドルール/独自のルール/ルールグループ/ステートメント/アクション/レートベース/WCUの制限
![[Pasted image 20250627010250.png]]
▼AWS WAF（Web ACL）
	![[Pasted image 20250627010425.png]]
	▼マネージドルールグループ
		新しい問題が出ると自動的にルールが更新される
		・AWS マネージドルール：一般的な基地の攻撃手法の多くに対処
		・AWS Marketplace：各ベンダーごとの専門的なルールが利用可能
			※毎月のサブスクリプション料金が必要
	▼ルール・ステートメント・アクション
		![[Pasted image 20250627011328.png]]
		・ステートメント：リクエストを検査する
			・地理的一致
			・IPセット一致
				IPセットを作成する必要がある
			・正規表現パターンセット一致
				正規表現パターンセットを作成する必要がある
			・サイズ制約
			・SQLインジェクション攻撃
		・アクション：リクエストが検査の条件を満たした場合に実行するもの
			・Allow
			・Block
			・Count
			・CAPTHA
	▼ルールグループ
		![[Pasted image 20250627011439.png]]
	▼レートベースのルール
		![[Pasted image 20250627011744.png]]
		・過剰にリクエストが送られてくるIPに対してブロックする
		![[Pasted image 20250627011724.png]]
	▼Web ACLのWCU制限について
		![[Pasted image 20250627012003.png]]
		WCU（Web ACL rule capacity Units）は1500を超えてはならない
		※WCUは2023年4月のアップデートで1,500から5,000に引き上げられています


★【S3】オブジェクトストレージとは/S3の基本概念/静的ウェブサイトホスティング機能/イベント通知機能/VPCエンドポイントでのアクセス
▼ストレージ3種類
	![[Pasted image 20250627172544.png]]
▼ファイルストレージとオブジェクトストレージの違い
	ファイルストレージ
		・階層構造のため大量ファイルの管理が難しい
		・ローカルネットワークでの利用が前提
		・スケーラビリティ（拡張性）に限界がある
	オブジェクトストレージ
		![[Pasted image 20250627173222.png]]
		・クラウドストレージサービスの普及
		・インターネット経由でのデータアクセスに向いている
		・HTTPベースのRESTfulAPIによるアクセス
		・HTTPメソッド（GET、POST、PUT、DELETEなど）を使用して操作する
▼S3
	オブジェクトストレージサービスで容量は実質無制限
	耐久性：99.999999999％（10億件に1件）
	可用性：99.95~99.99％（年間で4時間ほどデータを扱えない時間があるかも）
	・オブジェクト：保存するファイルのこと
	・バケット：オブジェクトが格納されるもの
		バケット名は世界中でユニークでなければならない
	![[Pasted image 20250627174621.png]]
	使用するURLのフォーマットが決まっている
	プレフィックス：フォルダのようなもの
	▼静的Webサイトホスティング機能
		![[Pasted image 20250627175053.png]]
		・HTMLやCSSの静的なwebコンテンツを配置すると、ネット上に公開される
		・動的なバックエンド処理は負荷
	▼イベント通知機能
		![[Pasted image 20250627175524.png]]
		バケットないで特別な動作が発生した時に、ほかのAWSサービスに自動的に連携する
	▼S3のVPCエンドポイント
		VPCエンドポイント：インターネットを返さずにS3に接続するためのもの
			プライベートIPアドレスを使用する
	▼その他の機能
		・ストレージクラス
		・ライフサイクル
		・マルチパートアップロード
		・Transfer Acceralation
		・暗号化方式
		・バージョニング


★【S3】アクセス制御/バケットポリシー/ACL/パブリックアクセスブロック/静的ウェブサイト機能の設定例
▼クロスアカウント時のバケットポリシー
	![[Pasted image 20250627182223.png]]
	リソースベースポリシー
▼ACL
	ACL：バケットやオブジェクトのアクセス権限を細かく決められるもの
	現在はACL無効が推奨されている
	理由は管理が複雑でセキュリティリスクが高まってしまうため
▼パブリックアクセスブロック
	全世界にアクセスを許すという設定
	![[Pasted image 20250627183225.png]]
▼静的ウェブサイトホスティングの設定
	![[Pasted image 20250627183424.png]]
	principalが*であることにより、だれでもアクセスが可能
	actionはgetのみを指定する


★【VPC】VPCエンドポイント / インターフェイス型 / ゲートウェイ型
▼VPCエンドポイント
	・プライベートサブネットと特定のAWSサービスを接続するVPCのサービス
	・アクセス負荷に応じて自動スケール
	▼インターフェース型（Private Link、インターフェースエンドポイント）
		実態はENI（セキュリティグループを設定する）
		有料（1時間当たり1.5円）
		対応AWSサービス
		![[Pasted image 20250627184924.png]]
	▼ゲートウェイ型
		ルートテーブルに自動設定される
		対応AWSサービス
		![[Pasted image 20250627185056.png]]
		pl（プリフィクスリスト）：AWSが提供するサービスIP群
		HTTPリクエストが送られ、そのエンドポイントがplの中にあるものに該当するため


★【ハンズオン】VPCエンドポイント-デモ / VPC内部DNSの動きについて補足
▼構成図
▼ゲートウェイ型
	![[Pasted image 20250630193532.png]]
①VPC、サブネット、EC2、IGを作成
	![[Pasted image 20250630194513.png]]
	![[Pasted image 20250630194641.png]]
②パブリック、プライベートで接続の差異を確認
	パブリックはS3まで届く
	![[Pasted image 20250701002537.png]]
	プライベートは届かない
	![[Pasted image 20250701002614.png]]
③ゲートウェイ型のエンドポイント作成
	![[Pasted image 20250701003830.png]]
	![[Pasted image 20250701003943.png]]
	![[Pasted image 20250701004026.png]]
	![[Pasted image 20250701004422.png]]
④プライベートサブネットからでも接続できること確認
	![[Pasted image 20250701004514.png]]
▼インターフェース型
①cloudwatchと接続できるか確認
	パブリック
	![[Pasted image 20250701005003.png]]
	プライベート
	![[Pasted image 20250701005029.png]]
②VPCエンドポイントインターフェース型作成





★【Route53】概要/名前解決の流れ/DNSレコード/フェイルオーバールーティング
▼Route 53概要
	![[Pasted image 20250701010549.png]]
	・VPCの外にある
	・albとドメインを紐づけ、albと紐ずいているIPアドレスと紐づいてることにより、ドメインからアクセスができる
▼Route 53
	・フルマネージド型のDNS（ドメインネームシステム）サービス
	・ヘルスチェック機能
		設定したエンドポイントが正常に動作しているかチェックしてくれる
	・ルーティングポリシー
		一つに障害がおきたらもう一つにルーティングするものなど
		ユーザの位置情報に基づいて不利和kるルーティングなど
	・ドメインを購入可能
	 ▼ホストゾーン
		 ![[Pasted image 20250701013658.png]]
		・Aレコード：ドメインとIPv4アドレスの関連付け
		・AAAAレコード：ドメインとIPv6アドレスの関連付け
		・Aliasレコード：ドメインとAWSサービスの関連付け
			一発でドメインからレコードに変換
		・CNAMEレコード：ドメインとURLの関連付け
			※2回変換している
			![[Pasted image 20250701013947.png]]
		・NSレコード：ドメイン情報を管理するサーバ
		・SOAレコード：ドメインの管理情報
	▼ルーティングポリシー
		・フェイルオーバールーティング
			![[Pasted image 20250701011943.png]]
			障害時に別のバケットにルーティングし、sorryの静的画面をユーザに表示する
		・シンプルルーティング
			![[Pasted image 20250701012818.png]]
			一つのリソースに対してルーティングするもの
		・加重ルーティング
			![[Pasted image 20250701012927.png]]
			10％の人に新機能を使ってもらいゆくゆくは100％にして全員に使ってもらう
		・レイテンシールーティング
			![[Pasted image 20250701013126.png]]
			一番応答時間が早いリソースに通信を流す
		・位置情報ルーティング
			![[Pasted image 20250701013228.png]]
			リクエストが発生した地域に対してルーティングをする
		・複数値回答ルーティング
			![[Pasted image 20250701013405.png]]
			ランダムに振り分ける


★【CloudFront】概要/設計のポイント
▼キャッシュについて
	![[Pasted image 20250701014144.png]]
	![[Pasted image 20250701014316.png]]
	中間地点にwebサーバを配置することにより高速に配信できる
▼CloudFront
	・フルマネージド型CDNサービス
	・世界中に100超えるエッジロケーションにコンテンツをコピーし、配信する
	・AWS Certificate Manager、AWS WAFなど各種AWSサービスとの連携
	![[Pasted image 20250701014910.png]]
	・Viewer：アクセスしてくる通信元
	・Origin：コンテンツの配信元
		EC2、S3、ELBのドメインに対して
	・Behaviors（振る舞い）
		Cache Policy：TTLを設定
		TTL：Originに最新のデータがあるか何秒おきに確認するかの設定
		![[Pasted image 20250701015156.png]]



★【ハンズオン】CloudFrontとS3のOAC機能デモ
▼OAC（Origin Access Control）機能
	![[Pasted image 20250701021218.png]]
	ユーザがCloudFront経由でS3にアクセスできる
	OACはユーザーのようなもの
①S3バケットの作成
	![[Pasted image 20250701021602.png]]
	![[Pasted image 20250701021616.png]]
②作成したS3バケットにhtmlファイルをアップロード
	![[Pasted image 20250701022134.png]]
	ファイルパス：C:\Users\megav\Documents\サーバー構築勉強\AWS学習\index.html
③静的ホスティング機能の編集
	プロパティタブの最下部
	![[Pasted image 20250701022351.png]]
④CloudFrontの作成
	![[Pasted image 20250701022559.png]]
	作成したバケットを選択
	![[Pasted image 20250701024303.png]]
	![[Pasted image 20250701024346.png]]
	作成
⑤作成したディストリビューションの最終更新日が日付になったことを確認
	![[Pasted image 20250701024707.png]]
⑥コンテンツが配信されていることを確認
	URL：https://d221u1x4bmqbji.cloudfront.net/index.html
	![[Pasted image 20250701024823.png]]


★共通鍵暗号方式 / 公開鍵暗号方式 / ハイブリッド暗号システム
▼鍵とは
	![[Pasted image 20250701031159.png]]
	解読不可能な文字列に置き換えたり、戻したりできる情報
▼共通鍵暗号方式
	![[Pasted image 20250701031313.png]]
	▼鍵配送問題
		![[Pasted image 20250701031411.png]]
▼公開鍵暗号方式
	![[Pasted image 20250701031612.png]]
	●補足
		![[Pasted image 20250701031711.png]]
▼ハイブリッド暗号システム
	![[Pasted image 20250701031826.png]]
	▼利点
		![[Pasted image 20250701031920.png]]


★証明書（公開鍵証明書） / 認証局（CA） / SSLサーバー証明書の仕組み
![[Pasted image 20250701032111.png]]▼証明書と認証局
	![[Pasted image 20250701032150.png]]
	![[Pasted image 20250701032341.png]]
	▼証明書が発行されるまでの流れ
		![[Pasted image 20250701032503.png]]
	▼認証局（CA）による証明書の執行
		![[Pasted image 20250701032611.png]]
▼SSLサーバ証明書の仕組み
	![[Pasted image 20250701032857.png]]


★【ACM】AWS Certificate Manager/証明書種類
▼AWS Certificate Manager
	AWS内でSSL/TLS証明書の発行や自動更新ができるサービス
	![[Pasted image 20250701033200.png]]
	▼メリット
		・無料で証明書の発行
		・有効期限を過ぎた証明書を自動更新
		・証明書の一元管理
		・ほかのAWSサービスと簡単に適合できる
			![[Pasted image 20250701033322.png]]
	▼種類
		・パブリック証明書/プライベート証明書
		![[Pasted image 20250701034032.png]]
	▼利用方法（ACMで発行された証明書の利用）
		![[Pasted image 20250701034128.png]]
	▼利用方法（外部で発行された証明書の利用）
		![[Pasted image 20250701034329.png]]
▼SSL/TL証明書の種類
	・DV証明書：ドメインの所有
		迅速の証明書が欲しい場合に適している
	・OV証明書：ドメインの所有、組織の法的実在性
		
	・EV証明書：ドメインの所有、組織の法的実在性、組織の物理的実在、運営状況
		金融機関や、オンラインショッピングサイトなど
▼ALBのSSLターミネーション
	![[Pasted image 20250701034619.png]]
	ALBにアタッチすることで後続のEC2などの内部の処理は複合化する必要がないので、処理が楽になる
▼まとめ
	![[Pasted image 20250701034812.png]]


★【ハンズオン】独自ドメインとHTTPSによるWebサイトのホスティング
①VPCおよび関連リソースの作成
	![[Pasted image 20250701161505.png]]
②IAMロールの作成
	![[Pasted image 20250701161645.png]]
③EC2構築
	![[Pasted image 20250701162048.png]]
	![[Pasted image 20250701162104.png]]
	![[Pasted image 20250701162119.png]]
	作成したElastic IPを割り当てる
	![[Pasted image 20250701162304.png]]
	セッションマネージャーから接続し、Nginxをインストールする
	![[Pasted image 20250701162512.png]]
	![[Pasted image 20250701162532.png]]
	コマンド
	Nginxのインストール
		sudo dnf install nginx
	Nginxの開始とシステム再起動時に自動的に開始されるように設定：
		sudo systemctl start nginx
		sudo systemctl enable nginx
	`/usr/share/nginx/html` ディレクトリに移動
		cd /usr/share/nginx/html
	`index.html` ファイルを作成
		sudo vi index.html
	Webページの確認
	URL：http://13.115.1.87/
	![[Pasted image 20250701163526.png]]
④Cloud Frontの作成
	![[Pasted image 20250701165144.png]]
	![[Pasted image 20250701165225.png]]
	![[Pasted image 20250701165114.png]]
	![[Pasted image 20250701171114.png]]
⑤Route53でホストゾーンの設定
	![[Pasted image 20250701174955.png]]
	![[Pasted image 20250701175305.png]]
	お名前ドットコムでネームサーバーの設定を変更する
		![[Pasted image 20250701175233.png]]






★【AWS Shield】StandardとAdvanced/試験問題例
▼AWS Shield
	フルマネージドでDDos攻撃を防いでくれるサービス
	DDos攻撃：標的のサービスに過剰な負荷を与える、悪意のある通信のこと
	![[Pasted image 20250701180419.png]]
	▼Standard/Advanced
		![[Pasted image 20250701180601.png]]
		保護レイヤー：OSI参照モデル
			L3：ネットワーク層
			L4：トランスポート層
			L7：アプリケーション層
	▼試験問題例
		![[Pasted image 20250701180710.png]]
		A：AWS Shield Standard
		理由：最も費用対効果の高い方法とあるので、特別な要件がない限りは無料を選択する


★サイバー攻撃（DDoS）に対するAWSが提唱する5つのベストプラクティス
▼攻撃対象領域を削減する
	![[Pasted image 20250701183434.png]]
▼スケールしいて攻撃を吸収できるようにする
	![[Pasted image 20250701183535.png]]
▼公開されたリソースを保護する
	![[Pasted image 20250701183640.png]]
▼通常時の動作について学習する
	![[Pasted image 20250701183801.png]]
▼攻撃に対する計画を作成する
	![[Pasted image 20250701183916.png]]


★【Docker-1】Dockerとコンテナの概要
▼コンテナ
	アプリケーションと依存関係をイメージとして１つにまとめ、ホストOSのカーネルを共有して動作させる、軽量な仮想化技術
	![[Pasted image 20250701200354.png]]
▼Docker
	コンテナイメージの作成・管理、コンテナの実行管理、イメージの共有・配布などを行う、コンテナ管理のプラットフォーム
	![[Pasted image 20250701200633.png]]
	
nslookup -type=NS takatonbo.blog